generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Promotion {
  id            String   @id @default(cuid())
  shortId       String   @unique @default(cuid())
  title         String
  price         String
  price_from    String?
  storeName     String
  affiliateLink String   @unique
  imageUrl      String
  coupon        String?
  createdAt     DateTime @default(now())
  
  clicks        PromotionClick[]
  views         PromotionView[]
}

model Analytics {
  id        String   @id @default(cuid())
  page      String
  userAgent String?
  referrer  String?
  country   String?
  city      String?
  device    String?
  timestamp DateTime @default(now())
  sessionId String?
  duration  Int?
  
  @@index([page])
  @@index([timestamp])
  @@index([sessionId])
}

model PromotionClick {
  id          String    @id @default(cuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  timestamp   DateTime  @default(now())
  userAgent   String?
  referrer    String?
  country     String?
  device      String?
  buttonType  String?
  
  @@index([promotionId])
  @@index([timestamp])
}

model PromotionView {
  id          String    @id @default(cuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  timestamp   DateTime  @default(now())
  userAgent   String?
  referrer    String?
  country     String?
  device      String?
  viewType    String?
  
  @@index([promotionId])
  @@index([timestamp])
}
